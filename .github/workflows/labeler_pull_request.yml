name: "Labeler Pull Request"

on:
  # Use pull_request_target trigger if you're targeting a pull request from a fork:
  pull_request:  # Safer alternative to pull_request_target:
    types: [opened, reopened, synchronize, edited]
    # branches:
    #   - main  # Only allow workflow to run on main branch PRs
  # issues:
  #   types:
  #   - opened

# Restrict the permissions granted to the use of secrets.GITHUB_TOKEN in this
# github actions workflow:
# https://docs.github.com/en/actions/security-guides/automatic-token-authentication
permissions:
  contents: read
  # pull-requests: read   # General permissions for reading PRs
  pull-requests: write  # Necessary permission to write labels
  issues: write         # Ensure labeler can add labels to PRs (since PRs are issues)

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }} # Recommended if you intend to make multiple deployments in quick succession.
  # cancel-in-progress: false

jobs:
  labeler:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write  # Grant write access only to this job

    steps:
      - name: Checkout (clone) repository with full history
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          persist-credentials: false  # Prevents accidental credential exposure
          submodules: true  # Fetch Hugo themes (true OR recursive)
          fetch-depth: 0    # Fetch all history for .GitInfo and .Lastmod

      - name: "Debug: Check file existence"
        run: ls -lR .github/

      # label based on PR title
      - name: Labeler Issue
        uses: github/issue-labeler@c1b0f9f52a63158c4adc09425e858e87b32e9685 # v3.4
        if: github.repository == 'scikit-plots/scikit-plots'
        continue-on-error: true
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}  # ${{ github.token }}
          enable-versioned-regex: 0
          include-body: 0
          include-title: 1
          sync-labels: 1
          configuration-path: ".github/labeler.yml"

  labeler-by-glob:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write  # Grant write access only to this job

    steps:
      - name: Checkout (clone) repository with full history
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          # repository: "owner/repositoryName" # The one of the available inputs, visit https://github.com/actions/checkout#readme to find more
          persist-credentials: false  # Prevents accidental credential exposure
          submodules: true  # Fetch Hugo themes (true OR recursive)
          fetch-depth: 0    # Fetch all history for .GitInfo and .Lastmod

      - name: "Debug: Check file existence"
        run: ls -lR .github/

      # label based on glob files
      - name: Labeler Glob
        # uses: thomasjpfan/labeler@v2.5.1
        uses: actions/labeler@8558fd74291d67161a8a78ce36a881fa63b766a9 # v5.0.0
        if: github.repository == 'scikit-plots/scikit-plots'
        continue-on-error: true
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"
          # max-labels: "4"  # thomasjpfan
          configuration-path: ".github/labeler-by-glob.yml"  # .github/labeler.yml

  pr-prefix-labeler:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write  # Grant write access only to this job

    steps:
      - name: Checkout (clone) repository with full history
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          persist-credentials: false  # Prevents accidental credential exposure
          submodules: true  # Fetch Hugo themes (true OR recursive)
          fetch-depth: 0    # Fetch all history for .GitInfo and .Lastmod

      - name: "Debug: Check file existence"
        run: ls -lR .github/

      - name: Labeler PR Prefix
        uses: gerrymanoim/pr-prefix-labeler@c8062327f6de59a9ae1c19f7f07cacd0b976b6fa # v3
        if: github.repository == 'scikit-plots/scikit-plots'
        continue-on-error: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          configuration-path: ".github/pr-prefix-labeler.yml"
